Group creation path
===================

First of all let's log in;
    >>> browser = Browser()
    >>> browser.open('http://localhost/')
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

We can add a group at the url /groups/add.

    >>> browser.open('http://localhost/groups/add')
    >>> browser.getControl('Group email address').value = 'test'
    >>> browser.getControl('Group title').value = 'Test group'
    >>> browser.getControl('Specify the school').value = 'Vilniaus universitetas'
    >>> browser.getControl('Save').click()

After creating the group we should be redirected to the subject selection view:

    >>> browser.printQuery('//h1/text()')
    Group Subjects
    Results:

We will skip this view for now, but it is an integral part of the group creation path.
    >>> browser.getLink('Finish choosing subjects').click()
    >>> browser.printQuery('//h1/text()')
    Group members

Let us fill in several email to be invited.
    >>> browser.getControl('Enter emails of the people You would like to invite to the group.').value='jonas@example.com, admin@ututi.lt'
    >>> browser.getControl('Invite').click()

The users should get emails:

    >>> from ututi.lib.mailer import mail_queue
    >>> msg = mail_queue.pop().message
    >>> print msg
    MIME-Version: 1.0
    Content-Type: text/plain; charset="us-ascii"
    Content-Transfer-Encoding: 7bit
    From: info@ututi.lt
    To: jonas@example.com
    Subject: Ututi group invitation
    <BLANKLINE>
    Adminas Adminovix has invited You to join the group Test group.
    <BLANKLINE>
    Since You do not appear to be a Ututi user at the moment, to become a member of this group, You will have to register first.
    <BLANKLINE>
    You can do this by following this link: http://localhost/register/...
    <BLANKLINE>
    The Ututi team
    <BLANKLINE>

Let's get the url from the message

    >>> from  ututi.lib.helpers import get_urls
    >>> print get_urls(msg)
    ['http://localhost/register/...']

First let us log out.

     >>> browser.getLink('Log out').click()
     >>> browser.open(get_urls(msg)[0])
     >>> browser.printQuery('//h1/text()')
     UTUTI - student information online

Let us fill out the registration form

     >>> form = browser.getForm(id='registration_form')
     >>> form.getControl('Fullname').value = 'Jonas Petraitis Petrauskas'
     >>> form.getControl('Email').value = 'jonas@example.com'
     >>> form.getControl('Password').value = 'asdfgh'
     >>> form.getControl('Repeat password').value = 'asdfgh'
     >>> form.getControl('Register').click()

We should get an email confirmation request:
     >>> print mail_queue.pop().message
     MIME-Version: 1.0
     Content-Type: text/plain; charset="us-ascii"
     Content-Transfer-Encoding: 7bit
     From: info@ututi.lt
     To: jonas@example.com
     Subject: Confirm the email for Ututi
     <BLANKLINE>
     We have received a request to confirm the ownership of this email by Jonas Petraitis Petrauskas on the Ututi system. If this email belongs to You, confirm it by clicking on this link:
     <BLANKLINE>
     http://localhost/confirm_user_email/...
     <BLANKLINE>
     Ututi team
     <BLANKLINE>

And we are redirected to the group that invited us.

     >>> browser.url
     'http://localhost/group/test'

