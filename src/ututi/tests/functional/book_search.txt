Tests for book search
=====================

Set up
------

    >>> browser = Browser.logIn()

    >>> from ututi.tests.functional import setUpBooks
    >>> setUpBooks(browser)
    >>> browser.open('http://localhost/books/')

Now let's find some books:

    >>> browser.click('search')
    >>> browser.printCssQuery('.book-title')

Hmm, we found no books, must be because we did not add any yet. Let's
fix that:

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Title').value = "My physics book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Book department').displayValue = ['Other']
    >>> browser.getControl('Book type').displayValue = ['VadovÄ—lis']
    >>> browser.getControl(name='other_science_type').displayValue = ['Kita']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Save').click()

Now let's go find it (empty search query returns all results):

    >>> browser.click('search')
    >>> browser.printCssQuery('.book-title')
    <h3 class="book-title">My physics book</h3>

Let's type some string that will not match neither the book title nor
the description:

    >>> browser.getControl('Search text').value = 'My maths book'
    >>> browser.click('search')

See, we found no books.

    >>> browser.printCssQuery('.book-title')

Entering physics returns the book though:

    >>> browser.getControl('Search text').value = 'physics'
    >>> browser.click('search')

    >>> browser.printCssQuery('.book-title')
    <h3 class="book-title">My physics book</h3>

The search term is displayed in the search box:

    >>> browser.getForm(id='search_form').getControl(name='text').value
    'physics'

In the search header area we have a dropdown that we can use to filter
our search results by city. By default it is set to 'all cities' and
displays the total amount of books that matched our search query:

    >>> browser.getControl(name='city').displayValue
    ['All cities (1)']

We can pick any city that has books matching our search criteria:

    >>> browser.getControl(name='city').displayOptions
    ['All cities (1)',
     'Vilnius (1)']
