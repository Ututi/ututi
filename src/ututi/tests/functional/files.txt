File upload and download
========================

First let's log in.

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/admin/files')
    >>> browser.printQuery("//h1/text()")
    Files

There should be a form to upload a new file.

    >>> form = browser.getForm('file_upload_form')
    >>> form.getControl('Title').value = "a file"
    >>> form.getControl('Description').value = "a new file"
    >>> import cStringIO
    >>> form.getControl('Upload').add_file(cStringIO.StringIO('The contents of the file.'), 'text/plain', 'file.txt')
    >>> form.getControl('Save').click()

Having uploaded the file, we should be presented with a list of all files present, with our new file available.

    >>> browser.printQuery('id("file_list")//a[@class="file-link"]/text()')
    a file
    >>> browser.getLink("a file").click()
    >>> browser.contents
    'The contents of the file.'

The download count of files is shown in the user's home portlet:
    >>> browser.open('http://localhost/home')
    >>> browser.printQuery('//div[@class="file_stats"]/span/text()')
    1
    1 (25 B)

.. and in his public profile:
    >>> browser.open('http://localhost/user/1')
    >>> browser.printQuery('//div[@class="file_stats"]/span/text()')
    1
    1 (25 B)

After the download of the file, the downloaded files count in the user list should indicate this:

    >>> browser.open('http://localhost/admin/users')
    >>> browser.printQuery('id("user_list")')
    <table id="user_list">
      <tr>
        <th></th>
        <th>Name</th>
        ...
      </tr>
      <tr>
        <td> 1. </td>
        <td>
          <a href="/user/4">Third user</a>
        </td>
    ...


The files are stored in our upload directory:

    >>> from ututi.tests.functional import listUploads
    >>> listUploads()
    /uploads/11865bf8/24c684d6/ceb7b850/77e94c7c
