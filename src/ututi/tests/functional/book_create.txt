Book creation tests
===================

Set up
------

    >>> browser = Browser.logIn()
    >>> from ututi.tests.functional import setUpBooks, make_file
    >>> setUpBooks(browser)
    >>> browser.open('http://localhost/books/')

    >>> from pkg_resources import resource_stream

When I'm not logged in, I can't add book. Not logged user will be redirected to login path

    >>> browser = Browser()
    >>> browser.open('http://localhost/books/add')
    >>> browser.url
    'http://localhost/books/login?came_from=http%3A%2F%2Flocalhost%2Fbooks%2Fadd'

When I log in, I can enter add book area.

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/books/add')
    >>> browser.url
    'http://localhost/books/add'


Setting up user profile information
-----------------------------------

    >>> browser.open('http://localhost')
    >>> browser.follow('Edit profile')
    >>> browser.click('Contacts')
    >>> browser.getControl('Mobile phone number').value = ""
    >>> browser.click('Save')
    >>> browser.open('http://localhost/books/add')

Then I enter my new school book information and confirm changes

    >>> browser.getControl('Book title').value = "My school book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['school']
    >>> browser.getControl('School grade').displayValue = ['1 kl.']
    >>> browser.getControl(name = 'school_science_type').displayValue = ['Fizika']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "Nemokama!"
    >>> browser.getControl('Image').add_file(*make_file('test_logo.png'))
    >>> browser.getControl(name='owner_name').value
    'Adminas Adminovix'
    >>> browser.getControl(name='owner_email').value
    'admin@uni.ututi.com'

Couse I haven't filled my phone number it should by empty

    >>> browser.getControl(name='owner_phone').value
    ''

Then I enter my phone number

    >>> browser.getControl(name='owner_phone').value = '+37067411111'

Then I save my book

    >>> browser.click('Save')
    >>> browser.url
    'http://localhost/books/show/4'

When I add second book, my earlyer inserted phone book must by autofiled by the number of my last book

    >>> browser.click('Upload a Book')
    >>> browser.getControl(name='owner_phone').value
    '+37067411111'

Then I update my profile information and insert phone number

    >>> browser.open('http://localhost')
    >>> browser.follow('Edit profile')
    >>> browser.click('Contacts')
    >>> browser.getControl('Mobile phone number').value = "+37067422222"

    >>> browser.click('Save')

I get confirmation sms

    >>> from ututi.lib.sms import sms_queue
    >>> sms_queue.pop()
    (u'+37067422222', u'Ututi registration code: ...')

When I add a book, now I see autofilled phone field with my phone number from profile

    >>> browser.open('http://localhost/books')
    >>> browser.click('Upload a Book')
    >>> browser.getControl(name='owner_phone').value
    '+37067422222'

Then I edit my new school book information, change it to "other" type and confirm changes

    >>> browser.open('http://localhost/books/edit/4')
    >>> browser.getControl('Book title').value = "My other book"
    >>> browser.getControl('Author').value = "Mr. other"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('Comment').value = "A changed perfect book"
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "999.00"
    >>> browser.getControl('Image').add_file(*make_file('test_logo.png'))
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://localhost/books/show/4'

Then I edit my new school book information again, and make mistake

    >>> browser.open('http://localhost/books/edit/4')
    >>> browser.getControl('Book title').value = ""
    >>> browser.getControl('Author').value = "Mr. other"
    >>> browser.getControl('Comment').value = "A changed perfect book"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "999.00"
    >>> browser.getControl('Image').add_file(*make_file('test_logo.png'))
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://localhost/books/4/update'

I enter my new university book information and confirm changes

    >>> browser.open('http://localhost/books/add')
    >>> browser.getControl('Book title').value = "My beautiful book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['university']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl(name = 'university_science_type').value = ['3']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Image').add_file(*make_file('test_logo.png'))
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://localhost/books/show/5'

I enter my new other type book information and confirm changes

    >>> browser.open('http://localhost/books/add')
    >>> browser.getControl('Book title').value = "My beautiful book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Image').add_file(*make_file('test_logo.png'))
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://localhost/books/show/6'

