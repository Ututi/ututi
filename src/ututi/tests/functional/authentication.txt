Tests for logging in, logging out, access denied and all related things
=======================================================================

-------------------------
Visiting a profile-related page should not crash if the user is not logged in.
    >>> browser = Browser()
    >>> browser.open('http://localhost/welcome')
    >>> browser.url
    'http://localhost/?came_from=http%3A%2F%2Flocalhost%2Fwelcome'


-------------------------

    >>> browser = Browser()
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.url
    'http://localhost/welcome'

    >>> browser.getLink('log out').click()
    >>> browser.url
    'http://localhost/'


-------------------------

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asd"
    >>> form.getControl('Login').click()

    >>> browser.url
    'http://localhost/login'

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value
    'admin@ututi.lt'

    >>> 'Wrong password or username!' in browser.contents
    True

    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.getLink('log out').click()

-------------------------

    >>> browser.open('http://localhost/group/moderators/members')
    >>> browser.url
    'http://localhost/?came_from=http%3A%2F%2Flocalhost%2Fgroup%2Fmoderators%2Fmembers'

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.getLink('log out').click()


-------------------------

    >>> browser.open('http://localhost/search')
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.url
    'http://localhost/profile/browse'

    >>> browser.getLink('log out').click()

-------------------------

    >>> browser.open('http://localhost/search')
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asd"
    >>> form.getControl('Login').click()

    >>> 'Wrong password or username!' in browser.contents
    True

    # XXX which one do we want?
    >>> browser.url
    'http://localhost/login'

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.url
    'http://localhost/profile/browse'

    >>> browser.getLink('log out').click()

-------------------------

    >>> res = app.post("/login",
    ...                params={'login': 'admin@ututi.lt', 'password': 'asdasd'})

    >>> from textwrap import dedent
    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': ''},
    ...                upload_files=[("attachment", "text.txt", "Test")])

    >>> browser.open('http://localhost/subject/vu/mat_analize')
    >>> browser.getLink('text.txt').click()
    >>> browser.url
    'http://localhost/login?came_from=%2Fsubject%2Fvu%2Fmat_analize%3Fserve_file%3D3'

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "user@ututi.lt"
    >>> form.getControl('Password').value = "password"
    >>> form.getControl('Login').click()

    >>> browser.url
    'http://localhost/subject/vu/mat_analize?serve_file=3'

    >>> browser.getLink('log out').click()

-------------------------

    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "user@ututi.lt"
    >>> form.getControl('Password').value = "password"
    >>> form.getControl('Login').click()

    >>> browser.open('http://localhost/group/moderators/members')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 403: Forbidden
