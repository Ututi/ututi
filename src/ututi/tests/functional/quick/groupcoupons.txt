Group Coupon testing
====================

When there are no available coupons, the coupon code input field should be invisible.

    >>> browser2 = Browser.logIn()
    >>> browser2.getLink('Create new group').click()

    >>> browser2.getControl('Group e-mail address').value = 'test2'
    >>> browser2.getControl('Group title').value = 'Another test group'
    >>> browser2.getControl('Year').value = ['2010']
    >>> browser2.getControl(name='location-0').value = 'U-niversity'
    >>> browser2.getControl('Gift coupon code')
    Traceback (most recent call last):
    ...
    LookupError: label 'Gift coupon code'


The admin should have a new link on his dashboard, that lets him view all active and inactive group coupons.

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/admin')
    >>> browser.getLink('Group coupons').click()
    >>> browser.url
    'http://localhost/admin/group_coupons'

    >>> form = browser.getForm('coupon_form')
    >>> form.getControl('Code').value = 'ABcd'
    >>> form.getControl('Day count (for unlimited space)').value = '50'
    >>> form.getControl('Valid until').value = '09/30/2030'
    >>> form.getControl('Save').click()

    >>> browser.url
    'http://localhost/admin/group_coupons'

    >>> browser.printQuery('id("coupon_list")//td/text()')
    ABCD
    ...
    2030 Sep 30, 00:00
    unlimitedspace
    50
    0

It should be impossible to create another coupon with the same code.
    >>> form = browser.getForm('coupon_form')
    >>> form.getControl('Code').value = 'ABcd'
    >>> form.getControl('Day count (for unlimited space)').value = '50'
    >>> form.getControl('Valid until').value = '09/30/2030'
    >>> form.getControl('Save').click()

    >>> browser.printQuery("//span[@class='error-message']/text()")
    Such coupon code already exists, choose a different one.

Entering an invalid coupon code should give us an error:

    >>> browser2.getLink('Home').click()
    >>> browser2.getLink('Create new group').click()

    >>> browser2.getControl('Group e-mail address').value = 'test2'
    >>> browser2.getControl('Group title').value = 'Another test group'
    >>> browser2.getControl('Year').value = ['2010']
    >>> browser2.getControl(name='location-0').value = 'U-niversity'
    >>> browser2.getControl('Gift coupon code').value = 'abcdef'
    >>> browser2.getControl('Continue').click()

    >>> browser2.url
    'http://localhost/groups/create'


Using the coupon code is simple:

    >>> browser2.getLink('Home').click()
    >>> browser2.getLink('Create new group').click()

    >>> browser2.getControl('Group e-mail address').value = 'test2'
    >>> browser2.getControl('Group title').value = 'Another test group'
    >>> browser2.getControl('Year').value = ['2010']
    >>> browser2.getControl(name='location-0').value = 'U-niversity'
    >>> browser2.getControl('Gift coupon code').value = 'abcd'
    >>> browser2.getControl('Continue').click()

    >>> browser2.printQuery("//div[@class='flash-message']/span/text()")
    Great! You have used a coupon code and will now get unlimited group private files for 50 days !


And once again, having used the coupon, since there are no more coupons available, the field will not be shown:

    >>> browser2.getLink('Home').click()
    >>> browser2.getLink('Create new group').click()

    >>> browser2.getControl('Group e-mail address').value = 'test2'
    >>> browser2.getControl('Group title').value = 'Another test group'
    >>> browser2.getControl('Year').value = ['2010']
    >>> browser2.getControl(name='location-0').value = 'U-niversity'
    >>> browser2.getControl('Gift coupon code')
    Traceback (most recent call last):
    ...
    LookupError: label 'Gift coupon code'
