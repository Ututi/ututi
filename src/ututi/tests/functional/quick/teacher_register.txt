Test registration of teachers
=============================

    >>> browser = Browser()

There currently is no link visible to the teacher registration, so
let's type in that url:

    >>> browser.open('http://localhost/teacher/register')
    >>> form = browser.getForm(id='teacher_registration_form')
    >>> form.getControl('Full name').value = 'Mr. teacher'
    >>> form.getControl('Email').value = 'teacher@uni.ututi.com'
    >>> form.getControl(name='new_password').value = 'mapassword'
    >>> form.getControl(name='agree').value = True
    >>> form.getControl('Register').click()

    >>> browser.url
    'http://localhost/register/welcome'

    >>> browser.printQuery("//div[@class='flash-message']//span/text()")
    All teacher tools will be available to You once our team confirms You as a teacher. Thank You!
    Your email (teacher@uni.ututi.com) is not confirmed! Please confirm your email by clicking on the link sent to your address or

The teacher is also shown a block that informs him he is not verified yet:
    >>> browser.printQuery("id('unverified_teacher_block')//text()")
    Welcome to Ututi!
    At the moment You are not confirmed as a teacher. Our administrators have been notified and will verify You shortly. Please be patient. Meanwhile please tell us more about yourself.


Teacher gets a confirmation email so he could approve his
registration. And the team gets a notification:
(Note: teacher has been assigned to the default university,
this is not how things supposed to work in real registration flow)

    >>> from ututi.lib.mailer import mail_queue
    >>> mail_queue.pop()
    <EmailInfo sender='info@ututi.lt' recipients=[u'teacher@uni.ututi.com']>

    >>> print mail_queue.pop().payload()
    A new teacher has registered:
    Mr. teacher (teacher@uni.ututi.com)
    U-niversity
    Ututi


Teachers can also register using facebook:
    >>> browser = Browser()
    >>> browser.open('/federation/test_facebook_teacher_login')
    >>> browser.url
    'http://localhost/teacher/federated_registration'
    >>> browser.getControl(name='agree').value = True
    >>> browser.getControl('Register').click()

The team is informed of this too:
(Note: teacher has been assigned to the default university,
this is not how things supposed to work in real registration flow)
    >>> print mail_queue.pop().payload()
    A new teacher has registered:
    John Smith (john.smith@example.com)
    U-niversity
    Ututi

    >>> browser.url
    'http://localhost/register/welcome?fb=True'

The administrator should now see a request to confirm a teacher:
    >>> browser2 = Browser.logIn()
    >>> browser2.open('http://localhost/admin')
    >>> browser2.getLink('Teachers').click()
    >>> browser2.printQuery("id('teacher_list')//td[@class='name']//text()")
    Mr. teacher
    John Smith

Let's try and accept the second teacher:
    >>> browser2.getControl('Confirm', index=1).click()
    >>> print mail_queue.pop().payload()
    John Smith,
    Your request to join Ututi as a teacher has been confirmed!
    You may now visit your Ututi dashboard here: http://localhost/ .
    At Ututi you will be able to::
    - Create your own profile with all Your courses and materials.
    - Easily publish Your lecture notes so that Your students can find and access them.
    - Easily communicate with Your students.
    The Ututi team

TODO: check if the user now can act as a teacher

Let's also reject the first teacher:
    >>> browser2.getControl('Deny', index=0).click()
    >>> print mail_queue.pop().payload()
    Mr. teacher,
    Your request to join Ututi as a teacher has been rejected.
    If this was a misunderstanding, please contact us directly at: info@ututi.lt.
    The Ututi team
