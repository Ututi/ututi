University and faculty structure
================================

    >>> from pkg_resources import resource_stream
    >>> def make_file(filename):
    ...     stream = resource_stream("ututi.tests.functional.import", filename)
    ...     return (stream, 'text/plain', filename)

First we log in to be able to see the user list.

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/structure')

There is one university and one faculty:

    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus universitetas
    Ekonomikos fakultetas
    Geografijos fakultetas

Let's try to add a new element.

    >>> form = browser.getForm(name='new_structure_form')
    >>> form.getControl('Title').value = 'Vilniaus Gedimino Technikos Universitetas'
    >>> form.getControl('Short title').value = 'vgtu'
    >>> form.getControl('Description').value = ''
    >>> form.getControl('Parent').displayOptions
    ['Select a parent', 'Vilniaus universitetas']
    >>> form.getControl('Parent').value = ['0']
    >>> browser.getControl('Logo').add_file(*make_file('test_logo.png'))
    >>> form.getControl('Save').click()

The new university is now shown.

    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus universitetas
    Ekonomikos fakultetas
    Geografijos fakultetas
    Vilniaus Gedimino Technikos Universitetas

    >>> form = browser.getForm(name='new_structure_form')
    >>> form.getControl('Title').value = 'Architekturos fakultetas'
    >>> form.getControl('Short title').value = 'af'
    >>> form.getControl('Description').value = ''
    >>> form.getControl('Parent').displayOptions
    ['Select a parent', 'Vilniaus universitetas', 'Vilniaus Gedimino Technikos Universitetas']
    >>> form.getControl('Parent').value = ['4']
    >>> form.getControl('Save').click()

    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus universitetas
    Ekonomikos fakultetas
    Geografijos fakultetas
    Vilniaus Gedimino Technikos Universitetas
    Architekturos fakultetas

Now we shall try to edit a structural element.

    >>> browser.getLink(text='Edit').click()

    >>> form = browser.getForm(name='edit_structure_form')
    >>> print form.getControl('Title').value
    Vilniaus universitetas
    >>> form.getControl('Title').value = u'Vinco Kapsuko universitetas'
    >>> print form.getControl('Short title').value
    vu
    >>> form.getControl('Short title').value = u'vku'
    >>> print form.getControl('Description').value
    Seniausias universitetas Lietuvoje.
    >>> form.getControl('Description').value = u'Nebeegzistuojantis fakultetas'
    >>> form.getControl('Parent').displayOptions
    ['Select a parent', 'Vilniaus Gedimino Technikos Universitetas']
    >>> form.getControl('Parent').value = ['4']

    >>> form.getControl('Save').click()

Let's try to enter a title that is way too long:
    >>> browser.getLink(text='Edit').click()

    >>> form = browser.getForm(name='edit_structure_form')
    >>> form.getControl('Title').value = u'40 characters are not that much text rly'*10
    >>> form.getControl('Save').click()
    >>> browser.printQuery("//span[@class='error-message']/text()")
    Enter a value less than 250 characters long


Let's look at the list:

    >>> browser.open('http://localhost/structure')
    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus Gedimino Technikos Universitetas
    Architekturos fakultetas
    Vinco Kapsuko universitetas
    Ekonomikos fakultetas
    Geografijos fakultetas

You can import the structure tags from csv too:

    >>> browser.open('http://localhost/admin')
    >>> form = browser.getForm(name='import_structure')
    >>> import cStringIO
    >>> from textwrap import dedent
    >>> csv_file = dedent("""\
    ... VU, Vilniaus Universitetas, ,
    ... gmf, Gamtos Mokslu Fakultetas, , vu
    ... """)

    >>> form.getControl('CSV File').add_file(cStringIO.StringIO(csv_file), 'text/plain', 'structure.csv')
    >>> form.getControl('Upload').click()


    >>> browser.open('http://localhost/structure')
    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus Gedimino Technikos Universitetas
    Architekturos fakultetas
    Vinco Kapsuko universitetas
    Ekonomikos fakultetas
    Geografijos fakultetas
    Vilniaus Universitetas
    Gamtos Mokslu Fakultetas

Let's delete one item:
    >>> browser.getLink(text='Edit', index=2).click()
    >>> browser.getControl('Delete', index=1).click()

Its children should be gone too:
    >>> browser.printQuery("id('location_structure')//li/a[@class='tag_link']/text()")
    Vilniaus Gedimino Technikos Universitetas
    Architekturos fakultetas
    Vilniaus Universitetas
    Gamtos Mokslu Fakultetas
