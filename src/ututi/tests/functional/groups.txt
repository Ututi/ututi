Group adding and import
=======================

A list of all groups is show at /groups.

    >>> browser = Browser()
    >>> browser.open('http://localhost/groups')
    >>> browser.printQuery("id('group_list')//li/a/text()")
    Moderatoriai

The link of the group leads to its home page.

    >>> browser.getLink('Moderatoriai').click()
    >>> browser.url
    'http://localhost/group/moderators'
    >>> browser.printQuery('//h1/text()')
    Moderatoriai, 2009

We can add a group at the url /groups/add.

    >>> browser.open('http://localhost/groups/add')
    >>> browser.getControl('Address').value = 'test'
    >>> browser.getControl('Title').value = 'Test group'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery('//h1/text()')
    Test group, 2009

However, group ids are checked for uniqueness.

    >>> browser.open('http://localhost/groups/add')
    >>> browser.getControl('Address').value = 'test'
    >>> browser.getControl('Title').value = 'Test group'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery("//span[@class='error-message']/text()")
    Such id already exists, choose a different one.

And they must be valid local parts of email addresses.

    >>> browser.getControl('Address').value = 'test test'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery("//span[@class='error-message']/text()")
    Id cannot be used as an email address.

If you log in, you should be able to see the groups you are a member
of in your home page (at least for now):

    >>> browser = Browser()
    >>> browser.open('http://localhost/')
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.printQuery("id('group_portlet_header')")
    <h3 id="group_portlet_header">
      Groups
    </h3>

    >>> browser.printQuery("id('group_portlet_content')")
    <div class="content" id="group_portlet_content">
      <ul>
        <li>
          <a href="/group/moderators">Moderatoriai</a>
        </li>
      </ul>
    </div>

You can import more groups using the admin interface.

    >>> browser.open('http://localhost/admin')
    >>> form = browser.getForm(name='groups_import')
    >>> csv_data = 'exgroup, Imported group, Group imported from the old system, 2008, gmf, vu'
    >>> import cStringIO
    >>> form.getControl('CSV File').add_file(cStringIO.StringIO(csv_data),
    ...                                      'text/plain',
    ...                                       'users.csv')
    >>> form.getControl('Upload').click()
    >>> browser.open('http://localhost/groups')
    >>> browser.printQuery("id('group_list')//li/a/text()")
    Moderatoriai
    Test group
    Imported group

And you can import group memberships using the admin interface too.

    >>> browser.open('http://localhost/admin')
    >>> form = browser.getForm(name='group_members_import')
    >>> csv_data = 'exgroup, admin@ututi.lt, True'
    >>> import cStringIO
    >>> form.getControl('CSV File').add_file(cStringIO.StringIO(csv_data),
    ...                                      'text/plain',
    ...                                       'group_members.csv')
    >>> form.getControl('Upload').click()
    >>> browser.open('http://localhost/group/exgroup/members')
    >>> browser.printQuery("id('group_member_list')//li/text()")
    Adminas Adminovix
