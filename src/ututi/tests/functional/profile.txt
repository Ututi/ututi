User profiles
=============

    >>> from pkg_resources import resource_stream
    >>> def make_file(filename):
    ...     stream = resource_stream("ututi.tests.functional.import", filename)
    ...     return (stream, 'text/plain', filename)

Each user will have a profile that is accessible via the url /profile/{id}.

    >>> browser = Browser()
    >>> browser.open('http://localhost/user/1')
    >>> browser.printQuery('//h1/text()')
    Latest actions

Now we'll try editing our profile information. First we need to log in.

    >>> browser = Browser.logIn()

    >>> browser.printQuery("id('personal-box')//div[@class='fullname']/text()")
    Adminas Adminovix

We'll go to our profile edit page. And change our name as well as upload a logo.

    >>> browser.open('http://localhost/profile/edit')
    >>> browser.getControl('Full name').value = 'Adminas Adminas'
    >>> browser.getControl('Address of your website or blog').value = 'http://ututi.lt'
    >>> browser.getControl('About yourself').value = 'This is me'
    >>> browser.getControl('Personal logo').add_file(*make_file('test_logo.png'))
    >>> browser.getControl('Save').click()

    >>> browser.printQuery("id('personal-box')//div[@class='fullname']/text()")
    Adminas Adminas
    >>> browser.printQuery("id('personal-box')//div[@class='personal-logo']//img")
    <img src="/user/1/logo/60/60" alt="logo" />

    >>> browser.printQuery("id('user_information_portlet')//div[@class='user-information']/h3/text()")
    Adminas Adminas

    >>> browser.printQuery("id('user_information_portlet')//div[@class='email']/a/text()")
    admin@ututi.lt

    >>> browser.printQuery("id('user_information_portlet')//div[@class='user-link']/a/text()")
    http://ututi.lt

Let's check out the logo.
    >>> browser.open('http://localhost/user/1/logo/45/60')

The content type should be PNG (all resized images are served as PNGs).

    >>> browser.headers['content-type']
    'image/png'

The size of the image should be as was specified in the request.

    >>> from PIL import Image
    >>> import StringIO
    >>> im = Image.open(StringIO.StringIO(browser.contents))
    >>> im.size
    (45, 45)

Now let's try to delete the logo.

    >>> browser.open('http://localhost/profile/edit')
    >>> browser.getControl('Delete current logo').selected = True
    >>> browser.getControl('Save').click()

The logo is gone from the profile page:

    >>> browser.printQuery("id('personal-box')//div[@class='personal-logo']/img")

And you can't download it anymore:

    >>> browser.open('http://localhost/user/1/logo/45/60')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found
