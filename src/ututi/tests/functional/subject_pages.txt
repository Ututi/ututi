Test for simple subject page management
=======================================

Let's log in:

    >>> browser = Browser.logIn()

And go to the subjects list.

    >>> browser.open('http://localhost/admin/subjects')

Pick a subject.

    >>> browser.getLink(u'Matematin\u0117 analiz\u0117'.encode('utf-8')).click()

And add a page for it.
    >>> browser.getLink('New page').click()
    >>> browser.getControl('Title').value = "How to be awesome!"
    >>> browser.getControl('Content').value = "Being Awesome is easy!"
    >>> browser.getControl('Save').click()

We should get redirected to the index view of the page we just created.

    >>> browser.url
    'http://localhost/subject/vu/mat_analize/page/3'

    >>> browser.printQuery("id('page_header')//h1/text()")
    How to be awesome!

    >>> browser.printQuery("id('page_content')")
    <div id="page_content">
      Being Awesome is easy!
    </div>

Let's edit the page now.

    >>> browser.getLink('Edit', index=1).click()
    >>> browser.getControl('Content').value = "<script>Yeah!</script>Being Awesome is very easy!"
    >>> browser.getControl('Save').click()

And see how it works.

    >>> browser.url
    'http://localhost/subject/vu/mat_analize/page/3'

    >>> browser.printQuery("id('page_header')//h1/text()")
    How to be awesome!

    >>> browser.printQuery("id('page_content')")
    <div id="page_content">
      Being Awesome is very easy!
    </div>

What about our brand new embedded latex syntax:

    >>> browser.getLink('Edit', index=1).click()
    >>> browser.getControl('Content').value = r"<script>Yeah!</script>Being Awesome is very easy! $$\sum_{n=1}^\infty a_n$$"
    >>> browser.getControl('Save').click()

    >>> browser.printQuery("id('page_content')")
    <div id="page_content">
      Being Awesome is very easy!
      <img class="latex" alt="\sum_{n=1}^\infty a_n" src="http://l.wordpress.com/latex.php?bg=ffffff&amp;fg=000000&amp;s=0&amp;latex=%5Cdisplaystyle+%5Csum_%7Bn%3D1%7D%5E%5Cinfty+a_n" />
    </div>

We can also view version history for the page:

    >>> browser.getLink('View history').click()

Let's look at the changes

    >>> browser.getControl('Compare with previous', index=0).click()

    >>> browser.printQuery("//ins")
    <ins>$$\sum_{n=1}^\infty a_n$$</ins>

    >>> browser.getLink('Go back to history').click()

We can also look at the previous version:

    >>> browser.getControl('Show', index=1).click()
    >>> browser.printQuery("id('old-version-note')")
    <div id="old-version-note" class="clear-left small">
          You are viewing an old version of this page created by <a href="/user/1">Adminas Adminovix</a> on ...
    </div>

    >>> browser.printQuery("id('page_content')")
    <div id="page_content">
      Being Awesome is very easy!
    </div>

    >>> browser.getLink('Go back to history').click()
    >>> browser.getLink('Go back to page').click()

As an admin, we can delete the page:

    >>> browser.getLink('Delete', index=1).click()

Let's go back:

    >>> browser.getLink('Go back to Matematin\xc4\x97 analiz\xc4\x97').click()
    >>> browser.url
    'http://localhost/subject/vu/mat_analize'

We should see the page on the list of pages, even though it has been deleted:

    >>> browser.printQuery("id('subject_pages')")
    <div id="subject_pages" class="section">
      <h2>Pages</h2>
      <div class="container">
        <br />
        <a class="btn" href="/subject/vu/mat_analize/pages/add">
          <span>New page</span>
        </a>
        <div class="search-item snippet-page">
          <span style="color: red; font-weight: bold">[DELETED]</span>
          <a href="/subject/vu/mat_analize/page/3" title="How to be awesome!" class="item-title larger">How to be awesome!</a>
          <span class="small" style="margin-left: 10px;">...</span>
          <a style="font-size: 0.9em;" href="/user/1">Adminas Adminovix</a>
          <div class="description">
          Yeah! Being Awesome is very easy! $$\sum_{n=1}^\infty a_n$$
        </div>
          <div class="item-tags">
      </div>
        </div>
      </div>
    </div>

Now, visit the page and undelete:

    >>> browser.getLink('How to be awesome!').click()
    >>> browser.getLink('Undelete').click()

We could delete it again if we wanted to:

    >>> browser.getLink('Delete', index=1)
    <Link text='Delete' url='http://localhost/subject/vu/mat_analize/page/3/delete'>

Now the page shows up in the index again without the "deleted" marker:

    >>> browser.getLink('Go back to Matematin\xc4\x97 analiz\xc4\x97').click()
    >>> browser.printQuery("id('subject_pages')")
    <div id="subject_pages" class="section">
      <h2>Pages</h2>
      <div class="container">
        <br />
        <a class="btn" href="/subject/vu/mat_analize/pages/add">
          <span>New page</span>
        </a>
        <div class="search-item snippet-page">
          <a href="/subject/vu/mat_analize/page/3" title="How to be awesome!" class="item-title larger">How to be awesome!</a>
          <span class="small" style="margin-left: 10px;">...</span>
          <a style="font-size: 0.9em;" href="/user/1">Adminas Adminovix</a>
          <div class="description">
          Yeah! Being Awesome is very easy! $$\sum_{n=1}^\infty a_n$$
        </div>
          <div class="item-tags">
      </div>
        </div>
      </div>
    </div>

Confirming bug fix: requesting page with a non-integer as its id was resulting in a crash.

    >>> browser.open('http://localhost/subject/vu/mat_analize/page/abrakadabra')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found

