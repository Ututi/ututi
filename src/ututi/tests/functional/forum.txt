Basic forum test
================

    >>> browser = Browser.logIn()
    >>> browser.getLink('Community').click()

    >>> browser.getControl('New topic').click()
    >>> browser.getControl('Subject').value = 'Hello!'
    >>> browser.getControl('Message').value = 'Hi guys!'
    >>> browser.getControl('Post').click()

    >>> browser.url
    'http://localhost/community/thread/4'

    >>> browser.printQuery('id("forum-thread")//div[@class="post-body"]/text()')
    Hi guys!

Messages can be edited:

    >>> browser.getControl('Edit').click()
    >>> browser.url
    'http://localhost/community/thread/4/edit'

Let's get back to the topic list:

    >>> browser.getLink('Back to thread')
    <Link text='Back to thread' url='http://localhost/community/thread/4'>
    >>> browser.getLink('Back to thread').click()

    >>> browser.getLink('Back to the topic list')
    <Link text='Back to the topic list' url='http://localhost/community'>
    >>> browser.getLink('Back to the topic list').click()

Links from the front page work:

    >>> browser.getLink('Hello!')
    <Link text='Hello!' url='http://localhost/community/thread/4'>

    >>> browser.getLink('Hello!').click()
    >>> browser.printQuery('id("forum-thread")//div[@class="post-body"]/text()')
    Hi guys!


Bugs forum
==========

The bugs forum works just fine too:

    >>> browser.open('http://localhost/bugs')

    >>> browser.getControl('New topic', index=0).click()
    >>> browser.url
    'http://localhost/bugs/new_thread'

    >>> browser.getControl('Subject').value = 'Help!'
    >>> browser.getControl('Message').value = 'My ututi is borken!'
    >>> browser.getControl('Post').click()

    >>> browser.url
    'http://localhost/bugs/thread/5'

    >>> browser.printQuery('id("forum-thread")//div[@class="post-body"]/text()')
    My ututi is borken!

Messages can be edited:

    >>> browser.getControl('Edit').click()
    >>> browser.url
    'http://localhost/bugs/thread/5/edit'

Let's get back to the topic list:

    >>> browser.getLink('Back to thread')
    <Link text='Back to thread' url='http://localhost/bugs/thread/5'>
    >>> browser.getLink('Back to thread').click()

    >>> browser.getLink('Back to the topic list')
    <Link text='Back to the topic list' url='http://localhost/bugs'>
    >>> browser.getLink('Back to the topic list').click()

Links from the front page work:

    >>> browser.getLink('Help!', index=0)
    <Link text='Help!' url='http://localhost/bugs/thread/5'>
    >>> browser.getLink('Help!', index=0).click()
    >>> browser.printQuery('id("forum-thread")//div[@class="post-body"]/text()')
    My ututi is borken!

    >>> browser2 = Browser.logIn('user2@ututi.lt', 'password')
    >>> browser2.open('http://localhost/bugs/thread/5')
    >>> browser2.getControl('Reply', index=0).click()
    >>> browser2.getControl('Message').value = 'it sure is'
    >>> browser2.getControl('Reply', index=1).click()

A couple of email notifications about the forum posts have been sent:

    >>> from ututi.lib.mailer import mail_queue
    >>> mail_queue
    [<EmailInfo sender='info@ututi.lt' recipients=['admin@uni.ututi.com']>]

    >>> print mail_queue[0].payload()
    Second user posted on the 'Bugs' forum:
    <BLANKLINE>
    it sure is
    <BLANKLINE>
    --
    You can find the thread online here:
    http://localhost/bugs/thread/5
    <BLANKLINE>
    The Ututi team

    >>> del mail_queue[:]

We should be able to search for messages posted in public forums:

    >>> browser.open('http://localhost/search')
    >>> form = browser.getForm('search_form')
    >>> form.getControl(name="text").value = "borken"
    >>> form.getControl('Search').click()
    >>> browser.printQuery("id('search-results')//a[@class='item-title larger bold']/text()")
    Help!
