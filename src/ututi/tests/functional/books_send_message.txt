Tests for private messages sending to book owner
================================================

Set up
------
    >>> from ututi.lib.mailer import mail_queue
    >>> browser = Browser.logIn()

    >>> from ututi.tests.functional import setUpBooks
    >>> setUpBooks(browser)
    >>> browser.open('http://localhost/books/')

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Title').value = "My physics book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Brief description of the book').value = "A perfect book for the evening"
    >>> browser.getControl('Book department').displayValue = ['School']
    >>> browser.getControl('School grade').displayValue = ['1 kl.']
    >>> browser.getControl(name='school_science_type').displayValue = ['Fizika']
    >>> browser.getControl('Book type').displayValue = ['VadovÄ—lis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "1000.00"
    >>> browser.getControl('Save').click()

Initialy first user has no messages in inbox

    >>> browser.open('http://localhost')
    >>> browser.printQuery("id('inbox-link')")
    <a id="inbox-link" href="/messages">
		 Inbox
	  <span class="edge"></span>
	</a>


I login and go to the book view, where I can see form for sending message to book owner

    >>> user2 = Browser.logIn('user2@ututi.lt', 'password')
    >>> user2.open('http://localhost/books')
    >>> user2.click('more')
    >>> user2.getControl('Message').value = "Hi, I will buy your book!"
    >>> user2.click('Send message')

Book owner will get my message
    >>> browser.open('http://localhost')
    >>> browser.printQuery("id('inbox-link')")
    <a id="inbox-link" href="/messages">
	  <strong>Inbox (1)</strong>
	  <span class="edge"></span>
	</a>

    >>> browser.click('Inbox (1)')
    >>> browser.printCssQuery(".post-title")
    <a href="/messages/thread/5" class="post-title">uBooks: Second user asks about book My physics book</a>
    >>> browser.click('uBooks: Second user asks about book My physics book')
    >>> browser.printCssQuery(".post-body")
	<div class="post-body">
      Second user sent you a private message, asking about book My physics book (http://localhost/books/show/4):<br />	  <br />
      Hi, I will buy your book!
	</div>
    >>> ##TODO: make test to check mails
    >>> ##print mail_queue.pop()
