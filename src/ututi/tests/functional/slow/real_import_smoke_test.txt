A test of all the import views together with an actual snapshot of ututi
========================================================================

Log in as admin:

    >>> browser = Browser.logIn()

Go to admin page:

    >>> browser.open('http://localhost/admin/import_csv')

And upload all the files one by one:

    >>> from ututi.tests.functional import import_csv
    >>> import_csv(browser, 'import_users', 'export_users.csv')
    >>> import_csv(browser, 'import_structure', 'export_structure.csv')
    >>> import_csv(browser, 'import_groups', 'export_groups.csv')
    >>> import_csv(browser, 'import_group_members', 'export_group_members.csv')

    >>> browser.open('http://localhost/structure/1/export')

    >>> from urllib2 import HTTPError
    >>> from pkg_resources import resource_string
    >>> from nous.mailpost import processEmailAndPost
    >>> import pylons.test
    >>> emails = resource_string("ututi.tests.functional.import", "export_group_forums.txt").split("=" * 72 + '\n')
    >>> from nous.mailpost.MailBoxerTools import splitMail
    >>> import rfc822
    >>> emails = filter(bool, emails)
    >>> emails.sort(key=lambda message: rfc822.parsedate(splitMail(message)[0]['date']))

    >>> from ututi.model.mailing import UtutiEmail
    >>> import email
    >>> for n, email_text in enumerate(emails):
    ...     if email_text:
    ...         try:
    ...             processEmailAndPost('http://localhost/got_mail', email_text, pylons.test.pylonsapp.config['files_path'])
    ...         except HTTPError, e:
    ...             message = email.message_from_string(email_text, UtutiEmail)
    ...             print "Email %d from %s was ignored" % (n, message.getFrom())

    >>> browser.open('http://localhost/group/archpio/forum')
    >>> browser.getLink('2').click()
    >>> browser.getLink('Pilot Post').click()

    >>> from ututi.lib.mailer import mail_queue
    >>> len(mail_queue)
    176
    >>> mail_queue[:] = []

    >>> browser.open('http://localhost/admin/admin_wall')
    >>> s1 = (browser.lastRequestPystones, browser.lastRequestSeconds)

    >>> browser.open('http://localhost/admin/admin_wall')
    >>> s2 = (browser.lastRequestPystones, browser.lastRequestSeconds)

    >>> browser.open('http://localhost/admin/admin_wall')
    >>> s3 = (browser.lastRequestPystones, browser.lastRequestSeconds)

    # >>> s1, s2, s3
