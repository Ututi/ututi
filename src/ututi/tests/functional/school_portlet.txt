School portlet tests
====================


SETING UP

    >>> from pkg_resources import resource_stream
    >>> from ututi.tests.functional import make_file

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/structure')

    >>> form = browser.getForm(name='new_structure_form')
    >>> form.getControl('Title').value = 'Vilniaus Gedimino Technikos Universitetas'
    >>> form.getControl('Short title').value = 'vgtu'
    >>> form.getControl('Description').value = ''
    >>> form.getControl('Parent').displayOptions
    ['Select a parent', 'U-niversity', 'Vilniaus universitetas']
    >>> form.getControl('Parent').value = ['0']
    >>> browser.getControl('Logo').add_file(*make_file('test_logo.png'))
    >>> form.getControl('Create').click()
    >>> form = browser.getForm(name='new_structure_form')
    >>> form.getControl('Title').value = 'Architekturos fakultetas'
    >>> form.getControl('Short title').value = 'af'
    >>> form.getControl('Description').value = ''
    >>> form.getControl('Parent').displayOptions
    ['Select a parent', 'U-niversity', 'Vilniaus universitetas', 'Vilniaus Gedimino Technikos Universitetas']
    >>> form.getControl('Parent').value = ['7']
    >>> form.getControl('Create').click()

END OF SETTING UP

Not logged in user can see students number of university

    >>> browser = Browser()
    >>> browser.open('http://localhost/team/vu')
    >>> browser.printCssQuery("#location-info-portlet .member-count", strip=True)
    <li>0 Members</li>

He can see "I study here" button which takes him to registration:

    >>> browser.getControl('I study here').click()
    >>> browser.printCssQuery('h1.page-title', strip=True)
    <h1>Registration to Vilniaus universitetas</h1>

    >>> browser.open('http://localhost/school/vu/ef')
    >>> browser.getControl('I study here').click()
    >>> browser.printCssQuery('h1.page-title', strip=True)
    <h1>Registration to Ekonomikos fakultetas</h1>

Logged user should not see "I study here" button in university and faculty portlet,
because he already has his LocationTag set:

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/team/vu')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/vgtu')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/uni')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/vu/ef')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

But he sees "I study here" button in HIS university faculties:

    >>> browser.open('http://localhost/team/uni/dep')
    >>> browser.printCssQuery("form#i_study_here_form button")
    <button class="submit" value="I study here">I study here</button>

If user is joined faculty, he doesn't see "I study here" at all

    >>> browser.getControl('I study here').click()

    >>> browser.open('http://localhost/team/vgtu')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/vu/')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/vgtu/af')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/vu/ef')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/uni')
    >>> browser.printQuery("//form[@id='i_study_here_form']")

    >>> browser.open('http://localhost/team/uni/dep')
    >>> browser.printQuery("//form[@id='i_study_here_form']")
