Group forums
============

    >>> def create_threads(group_id):
    ...     from ututi.model import meta, Group, ForumPost, User
    ...     from ututi.lib.forums import make_forum_post
    ...     gr = Group.get(group_id)
    ...     cat = gr.forum_categories[0].id
    ...     u = User.get('admin@ututi.lt')
    ...     for i in range(12):
    ...         meta.Session.execute("SET ututi.active_user TO %d" % u.id)
    ...         post = ForumPost(u'Some thread', u'Some text', category_id=cat,
    ...                          thread_id=None)
    ...         meta.Session.add(post)
    ...     meta.Session.commit()

    >>> def create_posts(group_id):
    ...     from ututi.model import meta, Group, ForumPost, User
    ...     from ututi.lib.forums import make_forum_post
    ...     gr = Group.get(group_id)
    ...     cat = gr.forum_categories[0].id
    ...     u = User.get('admin@ututi.lt')
    ...     meta.Session.execute("SET ututi.active_user TO %d" % u.id)
    ...     thr = ForumPost(u'Some thread', u'Some text', category_id=cat,
    ...                     thread_id=None)
    ...     meta.Session.add(thr)
    ...     meta.Session.commit()
    ...     meta.Session.refresh(thr)
    ...     for i in range(21):
    ...         meta.Session.execute("SET ututi.active_user TO %d" % u.id)
    ...         post = ForumPost(u'Some reply', u'Some text', category_id=cat,
    ...                          thread_id=thr.id)
    ...         meta.Session.add(post)
    ...     meta.Session.commit()

    >>> def create_community_threads():
    ...     from ututi.model import meta, ForumPost, User
    ...     from ututi.lib.forums import make_forum_post
    ...     cat = 1
    ...     u = User.get('admin@ututi.lt')
    ...     for i in range(12):
    ...         meta.Session.execute("SET ututi.active_user TO %d" % u.id)
    ...         post = ForumPost(u'Some thread', u'Some text', category_id=cat,
    ...                          thread_id=None)
    ...         meta.Session.add(post)
    ...     meta.Session.commit()


    >>> browser = Browser.logIn()

Let's find the group:

    >>> browser.open('http://localhost/group/moderators')
    >>> browser.url
    'http://localhost/group/moderators/home'

    >>> browser.getLink('Edit').click()

    >>> browser.getControl('Forum type').value = ['forum']
    >>> browser.getControl('Save').click()

    >>> browser.url
    'http://localhost/group/moderators/home'

Let's enter the forum:

    >>> browser.getLink('Forum').click()

Let's test post paging:

    >>> browser.getLink('General').click()
    >>> browser.url
    'http://localhost/group/moderators/forum/3'

    >>> create_posts('moderators')

And there should be a pager now:

    >>> browser.reload()
    >>> browser.getLink('Some thread').click()
    >>> browser.printCssQuery('#pager', strip=True)
    <div>
      <span>1</span>
      <a>2</a>
    </div>
    >>> browser.getLink('2').click()

And create some threads:

    >>> create_threads('moderators')

    >>> browser.getLink('Forum').click()
    >>> browser.getLink('General').click()
    >>> print browser.url
    http://localhost/group/moderators/forum/3

The pager should be there:

    >>> browser.reload()
    >>> browser.printCssQuery('#pager', strip=True)
    <div>
      <span>1</span>
      <a>2</a>
    </div>
    >>> browser.getLink('2').click()

Test paging in community forum:
    >>> create_community_threads()
    >>> browser.getLink('Community').click()
    >>> browser.printCssQuery('#pager', strip=True)
    <div>
      <span>1</span>
      <a>2</a>
    </div>
    >>> browser.getLink('2').click()
