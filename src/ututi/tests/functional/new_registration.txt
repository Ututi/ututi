User registration flow
======================


A new Ututi user can start his registration on university page,
by clicking 'Register' button:

    >>> browser = Browser()
    >>> browser.open('http://localhost/')
    >>> browser.getLink('U-niversity').click()
    >>> browser.url
    'http://localhost/school/uni'

    >>> browser.getControl('Register').click()
    >>> browser.url
    'http://localhost/school/uni/register'

User has to type in a valid email address to initiate registration:

    >>> browser.getControl('Enter your email here:').value = 'what ever@example.com'
    >>> browser.getControl('Register').click()
    >>> browser.url
    'http://localhost/school/uni/register'

    >>> browser.printCssQuery('#registration_form .error-message', strip=True)
    <span>The username portion of the email address is invalid (the portion before the @: what ever)</span>

If user types in an existing email address, he will be redirected to login form:

    >>> browser.getControl('Enter your email here:').value = 'admin@uni.ututi.com'
    >>> browser.getControl('Register').click()
    >>> browser.url
    'http://localhost/school/uni/login'

User come back to registration view ant types new email:

    >>> browser.open('http://localhost/school/uni/register')
    >>> browser.getControl('Enter your email here:').value = 'user@example.com'
    >>> browser.getControl('Register').click()
    >>> browser.printQuery("//div[@class='text']/text()")
    We need to approve if you are owner of this email. You have received a confirmation code to user@example.com.

User must receive email with confirmation url.

    >>> from ututi.lib.mailer import mail_queue

    >>> msg = mail_queue.pop()
    >>> print msg.payload()
    We have received a request to confirm the ownership of this email on the Ututi system. If this email belongs to you, confirm it by clicking on this link:
    <BLANKLINE>
    http://localhost/school/uni/register/...
    <BLANKLINE>
    Ututi team

   >>> msg.recipients
   [u'user@example.com']


After clicking on confirmation URL user will see registration form.

   >>> from ututi.lib.helpers import get_urls
   >>> urls = get_urls(msg.payload())
   >>> browser = Browser()
   >>> browser.open(urls[0])

   >>> browser.printQuery(".text", selector='cssselect', strip=True)
   <div>You are registered to <strong>U-niversity</strong> network.</div>
