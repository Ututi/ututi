Test for templates and actions with expired books
=================================================

Set up
------

    >>> browser = Browser.logIn()
    >>> import datetime
    >>> from ututi.tests.functional import setUpBooks, setBooksExpirationTime, booksExpirationDates
    >>> setUpBooks(browser)
    >>> browser.open('http://localhost/books')

Add book

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My physics book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for the evening"
    >>> browser.getControl(name='department').value = ['school']
    >>> browser.getControl('School grade').displayValue = ['1 kl.']
    >>> browser.getControl(name='school_science_type').displayValue = ['Fizika']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "1000.00"
    >>> browser.getControl('Save').click()
    >>> setBooksExpirationTime(datetime.date.today() + datetime.timedelta(days=20))

When I edit book, its expiration date will change

    >>> expiration_dates = booksExpirationDates()
    >>> browser.click("My books")
    >>> browser.click("Edit")
    >>> browser.getControl("Book title").value = "My edited expired physics book"
    >>> browser.click("Save")
    >>> print(expiration_dates == booksExpirationDates())
    False

Add more books and make all added book expired

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My expired other book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Save').click()

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My expired University book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['university']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl(name='university_science_type').displayValue = ['Realiniai mokslai']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Save').click()
    >>> setBooksExpirationTime(datetime.datetime(2009, 10, 10, 10, 15))

Now add some not expired books

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My physics book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for the evening"
    >>> browser.getControl(name='department').value = ['school']
    >>> browser.getControl('School grade').displayValue = ['1 kl.']
    >>> browser.getControl(name='school_science_type').displayValue = ['Fizika']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "1000.00"
    >>> browser.getControl('Save').click()

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My other book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Save').click()

Then I go to "my books" page to see all my uploaded books

    >>> browser.click("My books")
    >>> browser.printCssQuery(".book-title")
    <h3 class="book-title">
      <a href="/books/show/7">My physics book</a>
    </h3>
    <h3 class="book-title">
      <a href="/books/show/8">My other book</a>
    </h3>
    <h3 class="book-title">My edited expired physics book</h3>
    <h3 class="book-title">My expired other book</h3>
    <h3 class="book-title">My expired University book</h3>

Some of them are shown as expired

    >>> browser.printCssQuery(".book-information-expired .book-title", strip=True)
    <h3>My edited expired physics book</h3>
    <h3>My expired other book</h3>
    <h3>My expired University book</h3>

I can expire a book by hand:

    >>> browser.click('Delete')
    >>> browser.printCssQuery(".book-information-expired .book-title", strip=True)
    <h3>My edited expired physics book</h3>
    <h3>My expired other book</h3>
    <h3>My expired University book</h3>
    <h3>My physics book</h3>

When I restore my expired book and I won't see it in expired books list

    >>> browser.click("Restore")
    >>> browser.printCssQuery(".book-information-long .book-title")
    <h3 class="book-title">
      <a href="/books/show/8">My other book</a>
    </h3>
    <h3 class="book-title">
      <a href="/books/show/4">My edited expired physics book</a>
    </h3>

    >>> browser.printCssQuery(".book-information-expired .book-title", strip=True)
    <h3>My expired other book</h3>
    <h3>My expired University book</h3>
    <h3>My physics book</h3>
