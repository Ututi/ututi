Invite members to group
=======================

    >>> from ututi.lib.mailer import mail_queue
    >>> def printEmails():
    ...     for email in mail_queue:
    ...         print email.recipients
    ...         print email.payload()


First of all let's log in;

    >>> browser = Browser.logIn()

Let's find the group.

    >>> browser.open('http://localhost/group/moderators')
    >>> browser.getLink('Members').click()
    >>> print browser.url
    http://localhost/group/moderators/members

Let's try and invite a new member to the group.

    >>> emails = 'user@ututi.lt, loser@ututi.lt, user2@ututi.lt, foo'
    >>> browser.getControl(name='emails').value = emails
    >>> browser.getControl('Invite').click()
    >>> browser.printQuery("//div[@class='flash-message']/span/text()")
    Users invited.
    Invalid email addresses detected: foo

The user should be listed in the invited users table.

    >>> browser.open('http://localhost/group/moderators/members')
    >>> browser.printQuery("//table[@class='group-invitations']/tr/td[@class='email']/text()")
    user2@ututi.lt
    user@ututi.lt
    loser@ututi.lt

    >>> len(mail_queue)
    3

We need another member in the group, so let's join as the invited user.

    >>> msg1, msg2, msg3 = mail_queue
    >>> user = Browser.logIn("user@ututi.lt", "password")

The user is accepting invitation from email by clicking on URL.

    >>> from ututi.lib.helpers import get_urls
    >>> urls = get_urls(msg2.payload())
    >>> invitation_url = urls[1]
    >>> user.open(invitation_url)
    >>> user.printCssQuery('.flash-message-content', strip=True)
    <span>Congratulations! You are now a member of the group 'Moderatoriai'</span>


Let's try accepting invitation with user wich is still not Ututi member.

    >>> new_user = Browser()
    >>> urls = get_urls(msg1.payload())
    >>> invitation_url = urls[1]
    >>> new_user.open(invitation_url)
    >>> new_user.printCssQuery('h1.page-title', strip=True)
    <h1>University information</h1>

    >>> new_user.serve()
