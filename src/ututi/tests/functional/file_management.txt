Tests for ajax file management views
====================================

File upload:

    >>> res = app.post("/login",
    ...                params={'login': 'admin@ututi.lt', 'password': 'asdasd'})

    >>> from textwrap import dedent
    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': ''},
    ...                upload_files=[("attachment", "text.txt", "Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/subject/vu/mat_analize/file/3/get">text.txt</a>
      <span class="date">...</span>
      <a href="/user/1" class="author">
        Adminas Adminovix
      </a>
      <input class="move_url" type="hidden" value="/subject/vu/mat_analize/file/3/move" />
      <input class="delete_url" type="hidden" value="/subject/vu/mat_analize/file/3/delete" />
      <img src="/images/delete.png" alt="delete file" class="delete_button" />
    </li>

    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': 'Some folder'},
    ...                upload_files=[("attachment", "image.png", "Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/subject/vu/mat_analize/file/4/get">image.png</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': ''},
    ...                upload_files=[("attachment", "other_text.txt", "Test Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/group/moderators/file/5/get">other_text.txt</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': 'Also a folder'},
    ...                upload_files=[("attachment", "more_text.txt", "Test Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/group/moderators/file/6/get">more_text.txt</a>
      ...
    </li>

Empty folder creation:

    >>> res = app.post("/subject/vu/mat_analize/create_folder",
    ...                params={'folder': 'Buga Buga',
    ...                        'section_id': '7'})
    >>> print dedent(res.body)
    <li class="alternative upload show" id="file_upload_button-7-..."><div>Buga Buga</div></li>
    <BLANKLINE>
    <div class="folder_file_area subfolder" id="file_area-7-...">
      <input class="folder_name" id="file_folder_name-7-..." type="hidden" value="Buga Buga" />
        <h4>
          Buga Buga <a href="#" id="delete_folder_button-7-..." class="delete_folder_button">(Delete)</a>
        </h4>
        <ul class="folder">
            <li class="message">There are no files here, this folder is empty!</li>
        </ul>
    </div>

    >>> res = app.post("/group/moderators/create_folder",
    ...                params={'folder': 'Uga Buga',
    ...                        'section_id': '8'})
    >>> print dedent(res.body)
    <li class="alternative upload show" id="file_upload_button-8-..."><div>Uga Buga</div></li>
    <BLANKLINE>
    <div class="folder_file_area subfolder" id="file_area-8-...">
      <input class="folder_name" id="file_folder_name-8-..." type="hidden" value="Uga Buga" />
        <h4>
          Uga Buga <a href="#" id="delete_folder_button-8-..." class="delete_folder_button">(Delete)</a>
        </h4>
        <ul class="folder">
            <li class="message">There are no files here, this folder is empty!</li>
        </ul>
    </div>

Deleting folders:

    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': 'Folder to delete'},
    ...                upload_files=[("attachment", "image.png", "Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/subject/vu/mat_analize/file/.../get">image.png</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': 'Also a folder to delete'},
    ...                upload_files=[("attachment", "more_text.txt", "Test Test")])
    >>> print dedent(res.body)
    <li class="file">
      <a href="/group/moderators/file/.../get">more_text.txt</a>
      ...
    </li>

    >>> res = app.post("/subject/vu/mat_analize/delete_folder",
    ...                params={'folder': 'Folder to delete'})
    >>> res.status
    '200 OK'

    >>> res = app.post("/group/moderators/delete_folder",
    ...                params={'folder': 'Also a folder to delete'})
    >>> res.status
    '200 OK'

Both folders should be gone:

    >>> browser = Browser()
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()

    >>> browser.open('http://localhost/subject/vu/mat_analize')
    >>> browser.printQuery('//h4')
    <h4>
                Buga Buga ...
    </h4>
    <h4>
                Some folder ...
    </h4>

    >>> browser.open('http://localhost/group/moderators/files')
    >>> browser.printQuery('//h4')
    <h4>Moderatoriai</h4>
    <h4>
                Also a folder ...
    </h4>
    <h4>
                Uga Buga ...
    </h4>

Deleting files:

    >>> app.get('/subject/vu/mat_analize/file/3/delete').status
    '200 OK'

    >>> app.get('/group/moderators/file/5/delete').status
    '200 OK'

    >>> app.get('/subject/vu/mat_analize/file/3/get', expect_errors=True).status
    '404 Not Found'

    >>> app.get('/group/moderators/file/5/get', expect_errors=True).status
    '404 Not Found'

    >>> app.post('/group/moderators/file/6/move',
    ...          params={'source_id': '1',
    ...                  'target_id': '1',
    ...                  'target_folder': 'Uga Buga'}).status
    '200 OK'

Moving files:

    >>> from ututi.tests.model.test_groups import printTree
    >>> from ututi.model import Group, LocationTag, Subject

    >>> printTree(Group.get('moderators'))
    Also a folder:
    Uga Buga:
       more_text.txt

    >>> app.post('/group/moderators/file/6/move',
    ...          params={'source_id': '1',
    ...                  'target_id': '2',
    ...                  'target_folder': 'Some folder'}).status
    '200 OK'

    >>> printTree(Group.get('moderators'))
    Also a folder:
    Uga Buga:

    >>> printTree(Subject.get(LocationTag.get(u'vu'), u'mat_analize'))
    Buga Buga:
    Some folder:
       image.png
       more_text.txt

    >>> app.post('/subject/vu/mat_analize/file/4/move',
    ...          params={'source_id': '2',
    ...                  'target_id': '1',
    ...                  'target_folder': ''}).status
    '200 OK'

    >>> printTree(Group.get('moderators'))
    image.png
    Also a folder:
    Uga Buga:

    >>> printTree(Subject.get(LocationTag.get(u'vu'), u'mat_analize'))
    Buga Buga:
    Some folder:
       more_text.txt
