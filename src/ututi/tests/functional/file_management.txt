Tests for ajax file management views
====================================

File upload:

    >>> res = app.post("/login",
    ...                params={'login': 'admin@ututi.lt', 'password': 'asdasd'})

    >>> from textwrap import dedent
    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': ''},
    ...                upload_files=[("attachment", "text;for you.txt", "Test")])
    >>> print dedent(res.body)
    <li class="file">
      <img alt="file icon" class="drag-target" src="/images/details/icon_drag_file_new.png" />
      <a href="/subject/vu/mat_analize/file/3/get">text;for you.txt</a>
      <span class="size">(4.0 b)</span>
      <span class="date">...</span>
      <a href="/user/1" class="author">
        Adminas Adminovix
      </a>
      <input class="move_url" type="hidden" value="/subject/vu/mat_analize/file/3/move" />
      <input class="copy_url" type="hidden" value="/subject/vu/mat_analize/file/3/copy" />
      <input class="delete_url" type="hidden" value="/subject/vu/mat_analize/file/3/delete" />
      <img src="/images/delete.png" alt="delete file" class="delete_button" />
    </li>

    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': 'Some folder'},
    ...                upload_files=[("attachment", r"c:\My Home\image.png", "Tst")])
    >>> print dedent(res.body)
    <li class="file">
      ...
      <a href="/subject/vu/mat_analize/file/4/get">image.png</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/file_info",
    ...                params={'section_id': 0})
    >>> print res.body
    {"text": "\n  <div class=\"area_size\">free space: 20.0 b</div>\n", "image": "\n  <img alt=\"0.0 b\" class=\"area_size_points\" src=\"/images/details/pbar0.png\" />\n", "section_id": "0"}

    >>> res = app.post("/group/moderators/upload_status",
    ...                params={'section_id': 0})
    >>> print res.body
    {"status": 2, "section_id": "0"}

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': ''},
    ...                upload_files=[("attachment", "other_text.txt", "Test Test")])
    >>> print dedent(res.body)
    <li class="file">
      ...
      <a href="/group/moderators/file/5/get">other_text.txt</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': 'Also a folder'},
    ...                upload_files=[("attachment", "more_text.txt", "Tst")])
    >>> print dedent(res.body)
    <li class="file">
      ...
      <a href="/group/moderators/file/6/get">more_text.txt</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/file_info",
    ...                params={'section_id': 0})
    >>> print res.body
    {"text": "\n  <div class=\"area_size\">free space: 8.0 b</div>\n", "image": "\n  <img alt=\"12.0 b\" class=\"area_size_points\" src=\"/images/details/pbar3.png\" />\n", "section_id": "0"}

    >>> res = app.post("/group/moderators/upload_status",
    ...                params={'section_id': 0})
    >>> print res.body
    {"status": 1, "section_id": "0"}

Empty folder creation:

    >>> res = app.post("/subject/vu/mat_analize/js_create_folder",
    ...                params={'folder': 'Buga Buga',
    ...                        'section_id': '7'})
    >>> print dedent(res.body)
    <BLANKLINE>
    <div class="target_item "><div class="upload target" id="file_upload_button-7-...">Buga Buga</div></div>
    <BLANKLINE>
    <div class="folder_file_area subfolder" id="file_area-7-...">
      <input class="folder_name" id="file_folder_name-7-..." type="hidden" value="Buga Buga" />
        <h4>
          Buga Buga <a href="/subject/vu/mat_analize/delete_folder?folder=Buga+Buga"
                       id="delete_folder_button-7-..." class="delete_folder_button">(Delete)</a>
        </h4>
        <ul class="folder">
            <li class="message">There are no files here, this folder is empty!</li>
        </ul>
    </div>

    >>> res = app.post("/group/moderators/js_create_folder",
    ...                params={'folder': 'Uga Buga',
    ...                        'section_id': '8'})
    >>> print dedent(res.body)
    <BLANKLINE>
    <div class="target_item "><div class="upload target" id="file_upload_button-8-...">Uga Buga</div></div>
    <BLANKLINE>
    <div class="folder_file_area subfolder" id="file_area-8-...">
      <input class="folder_name" id="file_folder_name-8-..." type="hidden" value="Uga Buga" />
        <h4>
          Uga Buga <a href="/group/moderators/delete_folder?folder=Uga+Buga"
                      id="delete_folder_button-8-..." class="delete_folder_button">(Delete)</a>
        </h4>
        <ul class="folder">
            <li class="message">There are no files here, this folder is empty!</li>
        </ul>
    </div>

Deleting folders:

    >>> res = app.post("/subject/vu/mat_analize/upload_file",
    ...                params={'folder': 'Folder to delete'},
    ...                upload_files=[("attachment", "image.png", "T")])
    >>> print dedent(res.body)
    <li class="file">
      ...
      <a href="/subject/vu/mat_analize/file/.../get">image.png</a>
      ...
    </li>

    >>> res = app.post("/group/moderators/upload_file",
    ...                params={'folder': 'Also a folder to delete'},
    ...                upload_files=[("attachment", "more_text.txt", "T")])
    >>> print dedent(res.body)
    <li class="file">
      ...
      <a href="/group/moderators/file/.../get">more_text.txt</a>
      ...
    </li>

    >>> res = app.post("/subject/vu/mat_analize/js_delete_folder",
    ...                params={'folder': 'Folder to delete'})
    >>> res.status
    '200 OK'

    >>> res = app.post("/group/moderators/js_delete_folder",
    ...                params={'folder': 'Also a folder to delete'})
    >>> res.status
    '200 OK'

Both folders should be gone:

    >>> browser = Browser.logIn()
    >>> browser.open('http://localhost/subject/vu/mat_analize')
    >>> browser.printQuery('id("page-content")//h4')
    <h4>
                Buga Buga ...
    </h4>
    <h4>
                Some folder ...
    </h4>

    >>> browser.open('http://localhost/group/moderators/files')
    >>> browser.printQuery('//h4')
    <h4>Moderatoriai</h4>
    <h4>
                Also a folder ...
    </h4>
    <h4>
                Uga Buga ...
    </h4>

Deleting files:

    >>> app.get('/subject/vu/mat_analize/file/3/delete').status
    '200 OK'

    >>> app.get('/group/moderators/file/5/delete').status
    '200 OK'

    >>> app.get('/subject/vu/mat_analize/file/3/get', expect_errors=True).status
    '404 Not Found'

    >>> app.get('/group/moderators/file/5/get', expect_errors=True).status
    '404 Not Found'

