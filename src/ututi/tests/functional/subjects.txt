Subject adding and import
=========================

A list of all subjects is show at /subjects.

    >>> browser = Browser.logIn()

    >>> browser.open('http://localhost/subjects')
    >>> browser.printQuery("id('subject_list')//li/a/text()")
    Matematinė analizė

The link of the subject leads to its home page.

    >>> browser.getLink('Matematinė analizė').url
    'http://localhost/subject/vu/mat_analize'

    >>> browser.getLink('Matematinė analizė').click()
    >>> browser.url
    'http://localhost/subject/vu/mat_analize'
    >>> browser.printQuery('//h2/text()')
    Subject files
    Pages

From there we can edit the subject.

    >>> browser.open('http://localhost/subject/vu/mat_analize/edit')
    >>> browser.getControl('Lecturer').value = 'Some other guy'
    >>> browser.getControl('Save').click()

The changed information should  be visible in the sidebar block.

    >>> browser.printQuery('id("subject_info_portlet_content")//div/text()')
    Some other guy

The subject's portlet contains a link that can be used to start watching the subject.

    >>> browser.getLink('Watch subject').click()
    >>> browser.printQuery("//div[@class='flash-message']/span/text()")
    Close
    The subject has been added to your watched subjects list.

If we click the link again, we stop watching the subject
We can add a subject at the url /subject/add

    >>> browser.getLink('Stop watching the subject').click()
    >>> browser.printQuery("//div[@class='flash-message']/span/text()")
    Close
    The subject has been removed from your watched subjects list.

    >>> browser.open('http://localhost/subjects/add')

    >>> browser.getControl(name='location-1').value = 'vu'
    >>> browser.getControl('Title').value = 'Test subject'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery('//h2/text()')
    Subject files
    Pages
    >>> print browser.url
    http://localhost/subject/vu/test_subject

The id is checked for uniqueness.

    >>> browser.open('http://localhost/subjects/add')
    >>> browser.getControl(name='location-1').value = 'vu'
    >>> browser.getControl('Title').value = 'Test subject'
    >>> browser.getControl('Lecturer').value = 'Some guy'
    >>> browser.getControl('Save').click()
    >>> print browser.url
    http://localhost/subject/vu/test_subject-some_guy

You can import more subjects using the admin interface.

    >>> browser.open('http://localhost/admin')
    >>> form = browser.getForm(name='import_subjects_without_ids')
    >>> csv_data = 'Imported subject, Professor,, vu, Description of the subject, "imported, subject"'
    >>> import cStringIO
    >>> form.getControl('CSV File').add_file(cStringIO.StringIO(csv_data),
    ...                                      'text/plain',
    ...                                       'subjects.csv')
    >>> form.getControl('Upload').click()
    >>> browser.url
    'http://localhost/subjects'
    >>> browser.printQuery("id('subject_list')//li/a/text()")
    Matematinė analizė
    Test subject
    Test subject
    Imported subject

Bug fix confirmation: going to subjects/create directly (e.g. refreshing a failed subject form)
would cause a crash
    >>> browser.open('http://localhost/subjects/create')
    >>> print browser.url
    http://localhost/subjects/add
