Subject adding and import
=======================++

A list of all subjects is show at /subjects.

    >>> browser = Browser()
    >>> browser.open('http://localhost/subjects')
    >>> browser.printQuery("id('subject_list')//li/a/text()")
    Matematinė analizė

The link of the subject leads to its home page.

    >>> browser.getLink('Matematinė analizė').url
    'http://localhost/subject/vu/mat_analize'

    >>> browser.getLink('Matematinė analizė').click()
    >>> browser.url
    'http://localhost/subject/vu/mat_analize'
    >>> browser.printQuery('//h1/text()')
    Matematinė analizė

We can add a subject at the url /subject/add

    >>> browser.open('http://localhost/subjects/add')

    >>> browser.getControl(name='location-1').value = 'vu'
    >>> browser.getControl('Id').value = 'test_subject'
    >>> browser.getControl('Title').value = 'Test subject'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery('//h1/text()')
    Test subject

The id is checked for uniqueness.

    >>> browser.open('http://localhost/subjects/add')
    >>> browser.getControl(name='location-1').value = 'vu'
    >>> browser.getControl('Id').value = 'test_subject'
    >>> browser.getControl('Title').value = 'Test subject2'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery("//span[@class='error-message']/text()")
    Such id already exists, choose a different one.

And they must not contain characters not allowed in urls.

    >>> browser.getControl('Id').value = '{}test_subject\/'
    >>> browser.getControl('Save').click()
    >>> browser.printQuery("//span[@class='error-message']/text()")
    The text contains invalid characters, only letters, numbers and the symbols - + _ are allowed.

You can import more subjects using the admin interface.

    >>> browser.open('http://localhost/')
    >>> form = browser.getForm('login_form')
    >>> form.getControl('Email').value = "admin@ututi.lt"
    >>> form.getControl('Password').value = "asdasd"
    >>> form.getControl('Login').click()


    >>> browser.open('http://localhost/admin')
    >>> form = browser.getForm(name='subjects_import')
    >>> csv_data = 'new_subj, Imported subject, Professor,, vu'
    >>> import cStringIO
    >>> form.getControl('CSV File').add_file(cStringIO.StringIO(csv_data),
    ...                                      'text/plain',
    ...                                       'subjects.csv')
    >>> form.getControl('Upload').click()
    >>> browser.url
    'http://localhost/subjects'
    >>> browser.printQuery("id('subject_list')//li/a/text()")
    Matematinė analizė
    Test subject
    Imported subject
