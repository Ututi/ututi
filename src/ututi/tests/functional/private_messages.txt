Private messages
================

Users can send each other private messages.

    >>> browser = Browser.logIn('user@ututi.lt', 'password')

Initially the inbox is empty:

    >>> browser.printQuery("id('inbox-link')")
    <a id="inbox-link" href="/profile/messages">
      Inbox
    </a>

Sending messages
----------------

Let's send a message:

    >>> browser.open('http://localhost/user/3')
    >>> browser.getControl('Send message').click()

    >>> browser.getControl('Subject').value = 'First message'
    >>> browser.getControl('Message').value = 'First!'
    >>> browser.getControl('Post').click()

    >>> browser.printQuery("//div[@class='flash-message']/span/text()")
    Message sent.

The message is visible in the mailbox:

    >>> browser.getLink('Inbox').click()
    >>> browser.getLink('First message').click()

    >>> browser.printQuery("//div[@class='post-body']/text()")
    First!

Receiving messages
------------------

The other user should have received the message

    >>> browser2 = Browser.logIn('user2@ututi.lt', 'password')
    >>> browser2.printQuery("id('inbox-link')")
    <a id="inbox-link" href="/profile/messages">
      <strong>Inbox (1)</strong>
    </a>

    >>> browser2.getLink('Inbox (1)').click()
    >>> browser2.getLink('First message').click()

    >>> browser2.printQuery("//div[@class='post-body']/text()")
    First!

There are no unread messages any more:

    >>> browser2.printQuery("id('inbox-link')")
    <a id="inbox-link" href="/profile/messages">
      Inbox
    </a>

Replying
--------

Let's reply:

    >>> browser2.getControl('Message').value = 'Second!'
    >>> browser2.getControl('Reply').click()

We can see both messages in a thread:

    >>> browser2.printQuery("//div[@class='post-body']/text()")
    First!
    Second!

The first user can see the reply:

    >>> browser = Browser.logIn('user@ututi.lt', 'password')
    >>> browser.getLink('Inbox (1)').click()
    >>> browser.getLink('First message').click()
    >>> browser2.printQuery("//div[@class='post-body']/text()")
    First!
    Second!
