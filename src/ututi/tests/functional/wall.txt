Test user wall functionality
============================

    >>> browser = Browser.logIn('user3@ututi.lt', 'password')

No events yet:

    >>> browser.getLink("What's new?").click()
    >>> browser.url
    'http://localhost/home/feed'

    >>> browser.printQuery('id("wall")//div[@class="description"]//text()')
    Adminas Adminovix
    joined the group
    Moderatoriai
    .
    Adminas Adminovix
    has created the subject
    Matematinė analizė
    .

But let's send some emails:

    >>> from ututi.tests.functional import send_test_message
    >>> send_test_message('simple_email.txt', '1', to='moderators@groups.ututi.lt')
    >>> send_test_message('simple_email.txt', '2', to='moderators@groups.ututi.lt', reply_to='1')
    >>> send_test_message('simple_email.txt', '3', to='moderators@groups.ututi.lt', reply_to='1')

    >>> browser.getLink("What's new?").click()
    >>> browser.printQuery('id("wall")//div[@class="description"]//text()')
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    joined the group
    Moderatoriai
    .
    Adminas Adminovix
    has created the subject
    Matematinė analizė
    .

Clear the mail_queue before doing anything:

    >>> from ututi.lib.mailer import mail_queue
    >>> mail_queue[:] = []

    >>> form = browser.getForm('mail_reply_form', index=0)
    >>> form.getControl(name='message').value = 'I am replying'
    >>> form.getControl('Send reply').click()
    >>> mail_queue.pop().payload()
    'I am replying'

    >>> mail_queue[:] = []

Let's check forum messages:
    >>> browser2 = Browser.logIn()
    >>> browser2.getLink('Testing group').click()

    >>> browser2.getLink('Forum').click()
    >>> browser2.url
    'http://localhost/group/testgroup/forum'

    >>> browser2.getControl('New topic').click()
    >>> browser2.getControl('Subject').value = 'This is a new forum thread!'
    >>> browser2.getControl('Message').value = 'And I am starting it!'
    >>> browser2.getControl('Post').click()
    >>> browser2.url
    'http://localhost/group/testgroup/forum/4/thread/8'

    >>> mail_queue[:] = []

No events yet:
    >>> browser = Browser.logIn('user2@ututi.lt', 'password')
    >>> browser.getLink('Home').click()
    >>> browser.getLink("What's new?").click()
    >>> browser.url
    'http://localhost/home/feed'

    >>> browser.printQuery('id("wall")//div[@class="content"]//text()')
    And I am starting it!

    >>> form = browser.getForm('forum_reply_form', index=0)
    >>> form.getControl(name='message').value = 'I am replying to your forum post'
    >>> form.getControl('Send reply').click()
    >>> print mail_queue.pop().payload()
    Second user posted on the 'Testing group' forum:
    I am replying to your forum post
    --
    You can find the thread online here:
    http://localhost/group/testgroup/forum/4/thread/8
    The Ututi team

Let's check the sms replies:
    >>> browser2.getLink('Testing group').click()
    >>> browser2.getControl(name='sms_message').value = 'Sending an sms!'
    >>> browser2.getControl('Send', index=2).click()

    >>> browser.getLink('Home').click()
    >>> browser.getLink("What's new?").click()
    >>> browser.printQuery('id("wall")//div[@class="content"]//text()')
    Sending an sms!
    And I am starting it!

    >>> browser.getControl(name='sms_message').value = 'Replying to an sms!'
    >>> browser.getControl('Send', index=0).click()

    >>> from ututi.lib.sms import sms_queue
    >>> len(sms_queue)
    2
    >>> sms_queue.pop()
    ('+37067812375', u'Replying to an sms!')


    >>> sms_queue[:] = []
