Test user wall functionality
============================

    >>> browser = Browser.logIn('user3@ututi.lt', 'password')

No events yet:

    >>> browser.getLink("News wall").click()
    >>> browser.url
    'http://localhost/home/feed'

    >>> browser.printQuery('id("wall")//div[@class="description"]//text()')
    Adminas Adminovix
    joined the group
    Moderatoriai
    .
    Adminas Adminovix
    has created the subject
    Matematinė analizė
    .

But let's send some emails:

    >>> from ututi.tests.functional import send_test_message
    >>> send_test_message('simple_email.txt', '1', to='moderators@groups.ututi.lt')
    >>> send_test_message('simple_email.txt', '2', to='moderators@groups.ututi.lt', reply_to='1')
    >>> send_test_message('simple_email.txt', '3', to='moderators@groups.ututi.lt', reply_to='1')

    >>> browser.getLink("News wall").click()
    >>> browser.printQuery('id("wall")//div[@class="description"]//text()')
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    has posted a new message
    Hello
    to the group
    Moderatoriai
    .
    Adminas Adminovix
    joined the group
    Moderatoriai
    .
    Adminas Adminovix
    has created the subject
    Matematinė analizė
    .

Clear the mail_queue before doing anything:

    >>> from ututi.lib.mailer import mail_queue
    >>> mail_queue[:] = []

    >>> form = browser.getForm('mail_reply_form', index=0)
    >>> form.getControl(name='message').value = 'I am replying'
    >>> form.getControl('Send reply').click()
    >>> mail_queue.pop().payload()
    'I am replying'

    >>> mail_queue[:] = []

Let's check forum messages:
    >>> browser2 = Browser.logIn()
    >>> browser2.getLink('Testing group').click()

    >>> browser2.getLink('Forum').click()
    >>> browser2.url
    'http://localhost/group/testgroup/forum'

    >>> browser2.getControl('New topic').click()
    >>> browser2.getControl('Subject').value = 'This is a new forum thread!'
    >>> browser2.getControl('Message').value = 'And I am starting it!'
    >>> browser2.getControl('Post').click()
    >>> browser2.url
    'http://localhost/group/testgroup/forum/4/thread/8'

    >>> mail_queue[:] = []

No events yet:
    >>> browser = Browser.logIn('user2@ututi.lt', 'password')
    >>> browser.getLink('Home').click()
    >>> browser.getLink("News wall").click()
    >>> browser.url
    'http://localhost/home/feed'

    >>> browser.printQuery('id("wall")//div[@class="content"]//text()')
    And I am starting it!

    >>> form = browser.getForm('forum_reply_form', index=0)
    >>> form.getControl(name='message').value = 'I am replying to your forum post'
    >>> form.getControl('Send reply').click()
    >>> print mail_queue.pop().payload()
    Second user posted on the 'Testing group' forum:
    I am replying to your forum post
    --
    You can find the thread online here:
    http://localhost/group/testgroup/forum/4/thread/8
    The Ututi team

Let's check the sms replies:
    >>> browser2.getLink('Testing group').click()
    >>> browser2.getControl(name='sms_message').value = 'Sending an sms!'
    >>> browser2.getControl('Send', index=2).click()

    >>> browser.getLink('Home').click()
    >>> browser.getLink("News wall").click()
    >>> browser.printQuery('id("wall")//div[@class="content"]//text()')
    Sending an sms!
    And I am starting it!

    >>> browser.getControl(name='sms_message').value = 'Replying to an sms!'
    >>> browser.getControl('Send', index=0).click()

    >>> from ututi.lib.sms import sms_queue
    >>> sms_queue.pop()
    ('+37067812375', u'Replying to an sms!')

    >>> sms_queue[:] = []


Let's check private messages:
    >>> browser.open('http://localhost/user/1')
    >>> browser.getControl('Send message').click()
    >>> browser.getControl('Message').value = 'I am sending you a message!'
    >>> browser.getControl('Subject').value = 'A message from me!'
    >>> browser.getControl('Post').click()

    >>> browser2.getLink('Home').click()
    >>> browser2.getLink("News wall").click()
    >>> browser2.printQuery('id("wall")//div[@class="content"]//text()')
    I am sending you a message!
    Replying to an sms!
    I am replying to your forum post
    I am replying

    >>> form = browser2.getForm('message_reply_form', index=0)
    >>> form.getControl(name='message').value = 'I am replying to your message!'
    >>> form.getControl('Send reply').click()

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Inbox').click()
    >>> browser.getLink('A message from me!').click()
    >>> browser.printQuery('//div[@class="post-body"]/text()')
    I am sending you a message!
    I am replying to your message!

Of course, we can change what we see on our wall:
    >>> browser2.getLink('Home').click()
    >>> browser2.getLink("News wall").click()
    >>> browser2.printQuery('id("wall")//div[@class="description"]//text()')
    Second user
    has sent you a private message "
    A message from me!
    ".
    Second user
    has sent an sms to the group
    Testing group
    .
    SMS credits can be used to send SMS messages to members of a group. There are two ways to purchase SMS credits:
    If you pay by bank,
    a large discount applies
    .
    Second user
    has posted a new message
    This is a new forum thread!
    in the forum
    Testing group
    .
    Third user
    has posted a new message
    Re: Hello
    to the group
    Moderatoriai
    .
    Second user
    joined the group
    Testing group
    .
    Third user
    joined the group
    Moderatoriai
    .

    >>> browser2.getLink('Edit shown updates.').click()
    >>> browser2.getControl('Mailing list posts').click()
    >>> browser2.getControl('Save').click()
    >>> browser2.printQuery('id("wall")//div[@class="description"]//text()')
    Second user
    has sent you a private message "
    A message from me!
    ".
    Second user
    has sent an sms to the group
    Testing group
    .
    SMS credits can be used to send SMS messages to members of a group. There are two ways to purchase SMS credits:
    If you pay by bank,
    a large discount applies
    .
    Second user
    has posted a new message
    This is a new forum thread!
    in the forum
    Testing group
    .
    Second user
    joined the group
    Testing group
    .
    Third user
    joined the group
    Moderatoriai
    .
