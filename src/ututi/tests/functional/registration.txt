User registration
=================

Our new users will be greated by a page that has a registration form
in it:

    >>> response = app.get('/')
    >>> form = response.forms['registration_form']

We will only require your email address, name and password:

    >>> form.set('fullname', 'Jonas Petraitis Petrauskas')
    >>> form.set('email', 'jonas@example.com')
    >>> form.set('new_password', 'asdfgh')
    >>> form.set('repeat_password', 'asdfgh')
    >>> response = form.submit()

After registration is complete we should be hailed by our welcome
screen:
    >>> response = response.follow()
    >>> print response.lxml.xpath("//body/h1")[0].text
    Welcome!


We have been logged in after signing up. Now let's log out and test more unfortunate
scenarios:
    >>> response = response.click('Log out')
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/?came_from=%2F'

    >>> "registration_form" in response.forms
    True

If we forget to enter the username, we get returned to the registration form, but an error
message is shown:
    >>> form = response.forms['registration_form']
    >>> form.set('email', 'jonas2@example.com')
    >>> form.set('new_password', 'asdfgh')
    >>> form.set('repeat_password', 'asdfgh')
    >>> response = form.submit()
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/'

    >>> 'registration_form' in response.forms
    True

    >>> 'Please enter your name to register.' in response
    True

Ok, now we forget to enter the email when registering. We should be redirected to the
registration form and shown an error message that we've forgotten the email.
    >>> form = response.forms['registration_form']
    >>> form.set('fullname', 'Domas Monkus')
    >>> form.set('new_password', 'asdfgh')
    >>> form.set('repeat_password', 'asdfgh')
    >>> response = form.submit()
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/'

    >>> 'registration_form' in response.forms
    True

    >>> 'Please enter your email address to register.' in response
    True

If we forget to enter the password, we should also get an error message.
    >>> form = response.forms['registration_form']
    >>> form.set('fullname', 'Domas Monkus')
    >>> form.set('email', 'jonas2@example.com')
    >>> response = form.submit()
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/'

    >>> 'registration_form' in response.forms
    True

    >>> 'Please enter your password to register.' in response
    True

If the passwords do not match we also get an error message.
    >>> form = response.forms['registration_form']
    >>> form.set('fullname', 'Domas Monkus')
    >>> form.set('email', 'jonas2@example.com')
    >>> form.set('new_password', 'asdfgh')
    >>> form.set('repeat_password', 'as')
    >>> response = form.submit()
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/'

    >>> 'registration_form' in response.forms
    True

    >>> print response.lxml.xpath('div[@class=message]').text
    Please enter your password to register.

If such an email already exists, we also get an error message (later we should get a link to reset the password if
we have forgotten it).
    >>> form = response.forms['registration_form']
    >>> form.set('fullname', 'Domas Monkus')
    >>> form.set('email', 'jonas@example.com')
    >>> form.set('new_password', 'asdfgh')
    >>> form.set('repeat_password', 'asdfgh')
    >>> response = form.submit()
    >>> response = response.follow()
    >>> response.request.url
    'http://localhost/'

    >>> 'registration_form' in response.forms
    True

    >>> print response.lxml.xpath('div[@class=message]').text
    This email has already been registered.





