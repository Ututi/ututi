Tests for filtering books in books catalog
==========================================

Set up
------

    >>> browser = Browser.logIn()

    >>> from ututi.tests.functional import setUpBooks
    >>> setUpBooks(browser)
    >>> browser.open('http://localhost/books')

Now let's add some books:

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My physics book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for the evening"
    >>> browser.getControl(name='department').value = ['school']
    >>> browser.getControl('School grade').displayValue = ['1 kl.']
    >>> browser.getControl(name='school_science_type').displayValue = ['Fizika']
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Kaunas']
    >>> browser.getControl('Price').value = "1000.00"
    >>> browser.getControl('Save').click()

The book gets added and we get redirected to it's display view.

    >>> browser.url
    'http://localhost/books/show/4'

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "My beautiful book 2"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl(name='department').value = ['other']
    >>> browser.getControl('City').displayValue = ['Vilnius']

    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Save').click()

    >>> browser.click('Upload a Book')
    >>> browser.getControl('Book title').value = "University book"
    >>> browser.getControl('Author').value = "Mr. God"
    >>> browser.getControl(name='department').value = ['university']
    >>> browser.getControl('Comment').value = "A perfect book for evening"
    >>> browser.getControl('Type').displayValue = ['Vadovėlis']
    >>> browser.getControl('City').displayValue = ['Vilnius']
    >>> browser.getControl(name='university_science_type').displayValue = ['Realiniai mokslai']
    >>> browser.getControl('Price').value = "50,00"
    >>> browser.getControl('Save').click()

Then we go to the books catalog:

    >>> browser.click('All Books')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/4">My physics book</a>
    </h3>
    <h3 class="book-title">
      <a href="/books/show/5">My beautiful book 2</a>
    </h3>
    <h3 class="book-title">
      <a href="/books/show/6">University book</a>
    </h3>

    >>> browser.getControl(name='city').displayOptions
    ['All cities (3)', 'Vilnius (2)', 'Kaunas (1)']

We can't just go and see the whole category such as all the books for
students, so let's go to the subtype instead:

    >>> browser.open('http://localhost/books/catalog/university')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/6">University book</a>
    </h3>

    >>> browser.getControl(name='city').displayOptions
    ['All cities (1)', 'Vilnius (1)']

    >>> browser.open('http://localhost/books/catalog/university/science/3')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/6">University book</a>
    </h3>

    >>> browser.open('http://localhost/books/catalog/university/science/4')
    >>> browser.printCssQuery("h3.book-title")

    >>> browser.open('http://localhost/books/catalog/school')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/4">My physics book</a>
    </h3>

    >>> browser.getControl(name='city').displayOptions
    ['All cities (1)', 'Kaunas (1)']

    >>> browser.open('http://localhost/books/catalog/school/science/1')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/4">My physics book</a>
    </h3>

    >>> browser.open('http://localhost/books/catalog/school/science/2')
    >>> browser.printCssQuery("h3.book-title")

    >>> browser.open('http://localhost/books/catalog/other')
    >>> browser.printCssQuery("h3.book-title", include_attributes=["class", "href"])
    <h3 class="book-title">
      <a href="/books/show/5">My beautiful book 2</a>
    </h3>

    >>> browser.getControl(name='city').displayOptions
    ['All cities (1)', 'Vilnius (1)']

Oh, and let's not go down in flames when a mistyped url is requested:
    >>> browser.open('http://localhost/books/catalog/university/sience')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found
